---
name: configure
description: Interactive configuration setup for Smart Router preferences
argument-hint: (no arguments)
allowed-tools: [Read, Write, AskUserQuestion]
---

# Configure Smart Router

Interactive setup for Smart Router user preferences. Creates or updates `.claude/smart-router.local.md` with your routing preferences.

## What This Does

Guides you through configuring:
1. **Routing mode** - How Smart Router selects tools (auto/ask/context)
2. **Display options** - Show reasoning for decisions
3. **Priority order** - Preferred plugin order
4. **Exclusions** - Plugins to never suggest

Creates `.claude/smart-router.local.md` with your choices.

## Process

### Step 1: Check for Existing Settings

First, check if settings file already exists:

```bash
.claude/smart-router.local.md
```

If it exists:
- Read current settings
- Show them to user
- Ask: "Update existing settings or start fresh?"

### Step 2: Ask Configuration Questions

Use AskUserQuestion tool to collect preferences interactively.

**Question 1: Routing Mode**

```
How should Smart Router select tools?

Options:
1. auto - Always pick best automatically (fastest, no questions)
   Best for: Users who trust the routing logic

2. ask - Always show ranked menu (most control)
   Best for: Users who want to choose every time

3. context - Use file context to auto-decide, show brief reasoning (balanced)
   Best for: Most users (recommended)

Which mode do you prefer?
```

**Question 2: Show Reasoning**

```
Show reasoning when routing to a tool?

Options:
1. yes - Show why tool was chosen (helpful for learning)
2. no - Minimal output (just route and go)

Show reasoning?
```

**Question 3: Priority Order** (optional)

```
Set preferred plugin order? (optional)

If you always prefer certain plugins, list them in order.
Otherwise, Smart Router uses specialty + context ranking.

Examples:
- "superpowers, pr-review-toolkit"
- "bmad, superpowers"
- Leave empty to skip

Enter plugin names (comma-separated) or press Enter to skip:
```

**Question 4: Exclude Plugins** (optional)

```
Exclude any plugins from suggestions? (optional)

List plugins you never want suggested.

Examples:
- "ralph-wiggum, old-plugin"
- Leave empty to skip

Enter plugin names (comma-separated) or press Enter to skip:
```

### Step 3: Validate Input

**Routing mode:**
- Must be: auto, ask, or context
- If invalid, ask again

**Show reasoning:**
- Must be: yes, no, true, false, y, n
- Convert to boolean

**Priority order:**
- Split by comma
- Trim whitespace
- Validate plugin names exist (check registry if available)
- Warn if plugin not found, but allow it

**Exclude plugins:**
- Same validation as priority order

### Step 4: Generate Settings File

**IMPORTANT: YAML Formatting Rules**

Follow these YAML syntax rules exactly:

1. **Boolean values:** Use `true` or `false` (not yes/no, not quoted)
   ```yaml
   showReasoning: true
   ```

2. **Arrays:** Use YAML array syntax with proper indentation
   ```yaml
   priorityOrder:
     - superpowers
     - pr-review-toolkit
   ```

   For empty arrays:
   ```yaml
   priorityOrder: []
   ```

3. **Strings:** No quotes needed for simple plugin names
   ```yaml
   routingMode: context
   ```

4. **Comments:** Use `#` for comments
   ```yaml
   # This is a comment
   routingMode: auto
   ```

**Generate file in this exact format:**

```yaml
---
# Smart Router Configuration
# Generated by /smart-router:configure on [DATE]

routingMode: [user-choice]

showReasoning: [true/false]

priorityOrder: [plugin-array or []]

excludePlugins: [plugin-array or []]

# Advanced: Context rules (edit manually if needed)
contextRules: []
---

# Smart Router User Preferences

This file was auto-generated. You can edit it manually or re-run `/smart-router:configure`.

## Current Settings

**Routing Mode:** [mode]
- [Explanation of what this mode does]

**Show Reasoning:** [yes/no]

**Priority Order:** [list or "None - using default ranking"]

**Exclude Plugins:** [list or "None"]
```

**Example with actual values:**

```yaml
---
# Smart Router Configuration
# Generated by /smart-router:configure on 2025-12-19

routingMode: context

showReasoning: true

priorityOrder:
  - superpowers
  - pr-review-toolkit

excludePlugins: []

# Advanced: Context rules (edit manually if needed)
contextRules: []
---

# Smart Router User Preferences
...
```

## To Reconfigure

Run `/smart-router:configure` again to update settings interactively.

## Manual Editing

You can also edit this file directly. See `smart-router.local.md.example` for all available options.
```

### Step 5: Write File and Confirm

1. Ensure `.claude/` directory exists:
```bash
mkdir -p .claude
```

2. Write settings file using Write tool

3. Show confirmation:
```
✅ Smart Router Configuration Saved

Settings saved to: .claude/smart-router.local.md

Your preferences:
- Routing mode: [mode]
- Show reasoning: [yes/no]
- Priority order: [list or "None"]
- Exclude plugins: [list or "None"]

Settings will take effect on the next routing decision.

To reconfigure: /smart-router:configure
To view settings: cat .claude/smart-router.local.md
```

## Examples

### Example 1: First-time Setup

```
You: /smart-router:configure

Smart Router: No existing settings found. Let's set up your preferences.

[Questions...]

User selections:
- Mode: context
- Reasoning: yes
- Priority: superpowers
- Exclude: none

Smart Router: ✅ Configuration saved to .claude/smart-router.local.md
```

### Example 2: Update Existing Settings

```
You: /smart-router:configure

Smart Router: Found existing settings:
- Routing mode: auto
- Show reasoning: true
- Priority order: superpowers, bmad

Update existing settings or start fresh?
(update/fresh): update

[Shows current values in questions, user can keep or change...]

Smart Router: ✅ Configuration updated
```

### Example 3: Quick Setup (Auto Mode)

```
You: /smart-router:configure

[User selects:]
- Mode: auto
- Reasoning: no
- Priority: (skip)
- Exclude: (skip)

Result: Minimal settings file, fully automatic routing
```

## Implementation Notes

**Use AskUserQuestion tool** for interactive prompts:
- One question at a time (don't overwhelm)
- Provide clear options
- Show examples
- Allow skipping optional settings

**Validate all inputs:**
- Routing mode must be valid
- Plugin names should exist (warn if not found)
- Boolean values normalized

**File safety:**
- Backup existing file before overwriting
- Use Write tool (not bash redirection)
- Ensure proper YAML syntax

**Error handling:**
- If `.claude/` is not writable, show error
- If settings file exists and user cancels, don't modify
- If invalid plugin names, warn but allow

### Step 6: Set Up Smart Router Early Reminder Hook (Optional)

Ask the user if they want to enable the Smart Router early reminder hook:

```
Would you like to enable the Smart Router early reminder hook?

This hook reminds Claude to check Smart Router BEFORE making tool decisions.
It fires when you submit task-related prompts (testing, brainstorming, debugging, etc.)

**Benefits:**
- Claude checks Smart Router first instead of randomly picking tools
- You see ALL available tools for your task
- Better tool selection based on context and preferences

**Smart filtering:**
- Only fires on task-related prompts (test, brainstorm, debug, etc.)
- Silent on simple prompts like "what's 2+2" (no spam!)

Options:
1. yes - Enable the hook (recommended for training mode)
2. no - Skip hook setup (you can enable it later)

Enable hook?
```

If user selects "yes", proceed with hook setup:

#### 6.1: Read Existing Settings

**CRITICAL: Never overwrite existing settings.json!**

Check if `.claude/settings.json` exists and read it:

```typescript
const settingsPath = Path(project_dir) / '.claude' / 'settings.json'
let currentSettings = {}

if (settingsPath.exists()) {
    currentSettings = JSON.parse(fs.readFileSync(settingsPath, 'utf-8'))
}
```

#### 6.2: Merge Hook Configuration

Merge the Smart Router hook into existing hooks array:

```python
# Get CLAUDE_PLUGIN_ROOT from environment
plugin_root = os.environ.get('CLAUDE_PLUGIN_ROOT', '')
if not plugin_root:
    # Fallback: try to locate plugin installation
    plugin_root = Path.home() / '.claude' / 'plugins' / 'cache' / 'smart-router-marketplace' / 'smart-router' / 'latest'

# Define the hook configuration (UserPromptSubmit for early reminder)
smart_router_hook = {
    "matcher": "*",  # Matches all prompts (filtering happens in script)
    "hooks": [
        {
            "type": "command",
            "command": f"python3 {plugin_root}/hooks/smart-router-enforcer.py",
            "timeout": 5
        }
    ]
}

# Initialize hooks structure if needed
if 'hooks' not in currentSettings:
    currentSettings['hooks'] = {}
if 'UserPromptSubmit' not in currentSettings['hooks']:
    currentSettings['hooks']['UserPromptSubmit'] = []

# Check if Smart Router hook already exists
existing_hooks = currentSettings['hooks']['UserPromptSubmit']
already_exists = any(
    'smart-router-enforcer' in str(hook.get('hooks', []))
    for hook in existing_hooks
)

if not already_exists:
    # Add our hook (MERGE, don't replace)
    currentSettings['hooks']['UserPromptSubmit'].append(smart_router_hook)
else:
    # Already exists, update the command path if needed
    for hook in existing_hooks:
        for h in hook.get('hooks', []):
            if 'smart-router-enforcer' in h.get('command', ''):
                h['command'] = f"python3 {plugin_root}/hooks/smart-router-enforcer.py"
```

#### 6.3: Write Merged Settings

Write back the merged settings:

```bash
mkdir -p .claude
```

Write using Write tool with proper JSON formatting:

```python
import json

settings_json = json.dumps(currentSettings, indent=2)
# Write to .claude/settings.json
```

#### 6.4: Copy Hook Script to Project (Optional)

Ask user if they want to copy the hook script locally:

```
Copy hook script to project?

Options:
1. yes - Copy to .claude/hooks/ (recommended for version control)
2. no - Use plugin's hook directly

Copy hook?
```

If yes:
```bash
mkdir -p .claude/hooks
cp ${CLAUDE_PLUGIN_ROOT}/hooks/smart-router-enforcer.py .claude/hooks/
chmod +x .claude/hooks/smart-router-enforcer.py
```

And update the hook command path to use local copy:
```
"command": "python3 ${CLAUDE_PROJECT_DIR}/.claude/hooks/smart-router-enforcer.py"
```

#### 6.5: Show Hook Setup Confirmation

```
✅ Smart Router Early Reminder Hook Configured

Hook type: UserPromptSubmit (fires before Claude makes decisions)
Hook location: .claude/settings.json
Script: [plugin/project location]

The hook will remind Claude to check Smart Router when you submit task-related prompts.

**Smart filtering enabled:**
- Fires on: test, brainstorm, debug, build, design, etc.
- Silent on: simple prompts like "what's 2+2"

To disable: Edit .claude/settings.json and remove the UserPromptSubmit hook
To test: Try a prompt like "I want to test my code" and watch Claude check Smart Router first
```

## Related

- `/smart-router:rebuild` - Rebuild plugin registry
- `smart-router.local.md.example` - All available options
- Smart Router skill - Uses these settings
- Hook script: `hooks/smart-router-enforcer.py`

---

After configuration, test by running a routing scenario:
```
"I need a code review"
```

Smart Router should now use your configured preferences, and the hook will remind you to check it first.
